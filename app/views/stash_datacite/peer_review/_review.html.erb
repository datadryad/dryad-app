<% if !@resource.submitted? && @resource.identifier.allow_review? %>
  <!-- This is only available if the version has not yet been submitted to the repository AND
     the associated journal allows a review workflow -->
  <div>
    <div>
      <%= form_with model: @resource, url: peer_review_path, local: false, authenticity_token: true do |f| %>
        <div id="stash_engine_resource_hold_for_peer_review" role="group" aria-labelledby="peer_review_label">
        <p><%= f.radio_button :hold_for_peer_review, false, class: "t-review__agree-to-license" %>
          <%= f.label :hold_for_peer_review, "Make my dataset available for public download as soon as possible", value: "false"%>  
         <p><%= f.radio_button :hold_for_peer_review, true, class: "t-review__agree-to-license" %>
          <%= f.label :hold_for_peer_review, "Keep my dataset private while my related article is in peer review", value: "true" %>
        </div>
        <p id="stash_engine_resource_hold_for_peer_review_disclaimer" <% if !@resource.hold_for_peer_review? %>hidden<% end %>>By choosing this option, your dataset will be private during your related article's peer review period, or for 6 months in cases where we do not know your related article's status. You will have access to a private dataset download URL to be shared with collaborators or the journal. Your dataset will not enter curation or be published. After submission, please <%= mail_to APP_CONFIG[:contact_us_uri], 'email us'  %> or edit this choice when your dataset is ready to enter curation.</p>
        <span class="c-input__error-message"><%= @error %></span>
        <%= f.hidden_field :id %>
      <% end %>
    </div>
    <br/>
    <script type="text/javascript">
     $('#stash_engine_resource_hold_for_peer_review input:radio').on('change', function(e) {
        $(this).closest('form').submit();
      });
    </script>
  </div>
<% else %>
  <div>
    <p>The private for peer review option is not available for this data submission<% if @resource.submitted? %>, because the data has already been submitted<% elsif @resource.identifier.pub_state == 'published' %>, because the data has been previously published<% elsif @resource.identifier.has_accepted_manuscript? %>, because the associated article has been accepted for publication by the journal <% elsif @resource.identifier.publication_article_doi %>, because the associated article has been published by the journal<% end %>. Upon submission, the dataset will proceed to our curation process for evaluation and publication.</p>
  </div>
<% end %>
