<div>
  <canvas id="dailyChart"></canvas>
  <br />
  <br />
  <canvas id="monthlyChart"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  generate_chart(
    document.getElementById('monthlyChart').getContext('2d'),
    <%= raw @monthly_data.to_json %>,
    'Monthly curation stats'
  )
  generate_chart(
    document.getElementById('dailyChart').getContext('2d'),
    <%= raw @daily_data.to_json %>,
    'Daily curation stats'
  )

  function generate_chart(ctx, rawData, title) {
    const labels = rawData.map(d => d.period);
    const field_keys = <%= raw @field_keys.to_json %>;
    const field_names = <%= raw @field_names.to_json %>;

    const colors = [
      '#1f77b4', // blue
      '#ff7f0e', // orange
      '#2ca02c', // green
      '#d62728', // red
      '#9467bd', // purple
      '#8c564b', // brown
      '#e377c2', // pink
      '#7f7f7f', // gray
      '#bcbd22', // olive
      '#17becf', // cyan
      '#ffbb78', // light orange
      '#98df8a', // light green
      '#c5b0d5'  // lavender
    ];

    const datasets = field_keys.map((field, i) => ({
      label: field_names[i],
      data: rawData.map(d => d[field]),
      borderColor: colors[i % colors.length],
      backgroundColor: colors[i % colors.length],
      tension: 0.3,
      fill: false,
      hidden: ['aar_size', 'ppr_size', 'datasets_to_be_curated', 'datasets_unclaimed'].includes(field)
    }));

    new Chart(ctx, {
      type: 'line',
      data: { labels, datasets },
      options: {
        responsive: true,
        interaction: { mode: 'index', intersect: false },
        stacked: false,
        plugins: {
          title: { display: true, text: title },
          legend: { position: 'bottom' }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Count' }
          },
          x: {
            title: { display: true, text: 'Period' }
          }
        }
      }
    })
  }
</script>
