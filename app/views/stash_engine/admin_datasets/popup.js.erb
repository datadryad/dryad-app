// open a modal dialog
<% case @field
when 'data'
  partial = 'stash_engine/admin_datasets/internal_data_popup'
  locals = { identifier: @identifier, title: params[:internal_datum_id] ? 'Edit datum' : 'Add datum' }
when 'note'
  partial = 'stash_engine/admin_datasets/curation_note_popup'
  locals = { identifier: @identifier, title: 'Add note' }
when 'stats'
  partial = 'stash_engine/admin_datasets/stats_popup_display'
  locals = {}
else
  partial = 'popup_form'
  locals = {}
end %>
document.getElementById('genericModalContent').innerHTML = "<%= escape_javascript(render partial: partial, locals: locals) %>";
document.getElementById('genericModalDialog').showModal();
document.getElementById('cancel_dialog').addEventListener('click', (e) => {
  e.preventDefault();
  document.getElementById('genericModalDialog').close();
});

<% if @field == 'waiver' %>
  <% if @identifier.payment_type == 'stripe' && @identifier.payment_id.starts_with?("in_") %>
    document.getElementById('popup_submit').setAttribute('hidden', 'hidden');
  <% else %>
    document.getElementById('waiver_basis').addEventListener('change', (e) => {
      const other = document.getElementById('other_div')
      if (e.currentTarget.value === 'other') other.removeAttribute('hidden')
      else other.setAttribute('hidden', 'hidden')
    })
  <% end %>
<% end %>

<% if @field == 'curation_activity' %>
  initDatePicker();
  document.getElementById('activity_status_select').addEventListener('change', (e) => {
    if (e.currentTarget.value === 'published' || e.currentTarget.value === 'embargoed') {
      document.getElementById('c-input_publication_date').removeAttribute('hidden');
    } else {
      document.getElementById('c-input_publication_date').setAttribute('hidden', 'hidden');
    }
  })
<% end %>